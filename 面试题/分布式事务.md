## ACID特性

- **原子性（Atomicity）**

  一个事务中所有操作，要么全部成功、要么全部失败，不会结束在中间某个环节。

  事务在执行过程中发生错误，会被回滚到事务之前的状态，就像这个事务从来没有执行过一样。

- **一致性(Consistency)**

  在一个事务执行之前和之后、数据库都必须处于一致性的状态。

  如果事务成功地完成，那么系统中所有变化将正确地应用，系统处于有效状态。如果在事务中出现错误，那么系统中的所有变化将自动地回滚，系统返回到原始状态。

- **隔离性(Isolation)**

  在并发环境中，当不同的事务同时操作相同的数据时，每个事务都有各自完整的数据空间，每个事务所做的修改必须与任何其他事务所做的修改隔离。一个事务查看数据更新时，数据所处的状态要么是另一个事务修改它之前的状态，要么是另一个事务修改它之后的状态，事务不会查看到中间状态的数据。

- **持久性(Durability)**

  事务只要成功结束，它对数据所做的更新就必须永久保存下来。即使发生数据库服务崩溃，重新启动数据库服务后，数据库还能恢复到数据成功结束时的状态。

## InnoDB原理

### 原子性

#### 回滚日志

​	想要保证事务的原子性，就需要在发生异常时，对已经执行的操作进行**回滚**，而在<code style='color:#c7254e'>MySQL</code>中，恢复机制是通过回滚日志（<code style='color:#c7254e'>undo log</code>）实现的，所有事务进行的修改都会先记录到这个回滚日志中，然后在对数据库中的对应行进行写入。

​	**回滚日志**除了能够在发生错误或者用户执行<code style='color:#c7254e'>Rollback</code>时提供回滚相关信息，他还能够在系统发生崩溃、数据库进程直接被杀死之后，当用户再次启动数据库进程时、还能够立刻通过查询回滚日志将之前未完成的事务进行回滚，这也就需要回滚日志必须先于数据持久化的操作。

​	**回滚日志**并不能将数据库物理地恢复到执行语句或者事务之前的样子；他是逻辑日志，当回滚日志被使用时，他只会按照日志逻辑地将数据库中的修改撤销掉，可以理解为：我们在事务中使用的每一条<code style='color:#c7254e'>insert</code>语句都对应了一条<code style='color:#c7254e'>delete</code>，每一条<code style='color:#c7254e'>update</code>也对应了一条相反的<code style='color:#c7254e'>update</code>。

### 持久性

​	与**原子性**一样，事务的**持久性**也是通过**日志**来实现的，<code style='color:#c7254e'>MySQL</code>使用重做日志（<code style='color:#c7254e'>redo log</code>）实现事务的持久性。**重做日志**分为两部分，一是内存中的重做日志缓冲区，因为重做日志缓存区在内容中，所以它是容易丢失的；另一个是在磁盘上的重做日志文件，它是持久的。

​	当我们在一个事务中尝试对数据进行修改时，它会先将数据从磁盘读入内存，并更新内存中的缓存数据，然后生成一条重做日志并写入重做日志缓存，当事务真正提交时，<code style='color:#c7254e'>MySQL</code>会将重做日志缓存中的内容刷新到重做日志文件中，再将内存中的数据更新到磁盘中。

### 隔离性

是通过数据库锁实现的。

### 一致性

是通过undo log实现的。

